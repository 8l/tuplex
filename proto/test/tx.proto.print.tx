module tx.proto.print

import tx.c.puts


print(cstr : &[]UByte) {
    puts( cstr^[0] );
}

/*
print_digit(d : Long) {
    digits := c"0123456789";
    str : [2]~UByte = c" ";
    if d >= 10 {
        puts(c"d greater than 9");
        return;
    }
    if d < 0 {
        puts(c"d less than 0");
        return;
    }
    str[0] = digits[d];
    puts(str);
}
*/

itoa(val : Long, cstr : &~[]~UByte) {
    itoa(val, cstr, UByte(10));
}

itoa(val : Long, cstr : &~[]~UByte, radix : UByte) {
    ##cstr^[0] = UByte(0);
    ##str := cstr^;
    v : ~Long;
    i : ~Int;
    if val == 0 {
        cstr^[0] = '0';
        cstr^[1] = UByte(0);
        return;
    }
    if val < 0 {
        v = -val;
        cstr^[0] = '-';
        i = 1;
    }
    else {
        v = val;
        i = 0;
    }
    first := i;
    while v > 0 {
        nextV := v / radix;
        digitV := v - nextV * radix;
        cstr^[i] = UByte(48 + digitV);
        v = nextV;
        i = i + 1;
    }
    cstr^[i] = UByte(0);
    
    ## reverse string:
    i = i - 1;
    end := i+first;
    while i > end/2 {
        c := cstr^[i];
        cstr^[i] = cstr^[end-i];
        cstr^[end-i] = c;
        i = i - 1;
    }
}

print(val : Long) {
    cstr : ~[100]~UByte;
    itoa(val, &cstr);
    print(&cstr);
}

main()->Int {
    print(0);
    print(1);
    print(-1);
    print(10);
    print(-10);
    print(12345678);
    print(-12345678);
    print(12345678900L);
    print(-12345678900L);
    return 0;
}
